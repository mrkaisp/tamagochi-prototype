# 操作仕様変更について

## 変更日
2025年10月6日

## 変更理由
現行の「左=戻る、中央=決定、右=送る」という直接的なボタン割り当てでは、ユーザーにとって直感的でなく、ドラクエやポケモンのような標準的なRPGの操作感と異なることが判明しました。

より直感的で分かりやすい「カーソル選択方式」に変更することで、ユーザー体験を向上させます。

---

## 変更内容

### 旧仕様（変更前）
| ボタン | 機能 |
|---|---|
| ボタン1（左） | 戻る |
| ボタン2（中央） | 決定 |
| ボタン3（右） | 送る |

- 各画面で固定的な機能が割り当てられている
- メイン画面で「左=設定」「右=ステータス」という直接遷移
- 選択肢が増えると対応しづらい

### 新仕様（変更後）
| ボタン | 機能 | 説明 |
|---|---|---|
| ボタン1（左） | カーソル移動（上/左） | 選択肢やメニュー項目を上または左方向に移動 |
| ボタン2（中央） | 決定 | カーソルで選択中の項目を実行・確定 |
| ボタン3（右） | カーソル移動（下/右） | 選択肢やメニュー項目を下または右方向に移動 |

**特徴**:
- すべての画面で選択可能な項目にカーソルを表示
- ボタン1/3でカーソルを循環移動させ、ボタン2で決定
- 画面遷移や機能実行は、すべて「カーソル選択→決定」の流れで統一
- カーソル位置は視覚的に明示（矢印、ハイライトなど）

---

## 各画面への影響

### メイン画面（03）
**旧**: 左ボタン→設定、右ボタン→ステータス  
**新**: カーソルで選択肢（ステータス、水やり、光、環境整備、設定）を選び、ボタン2で決定

### 設定画面（04）
**旧**: 選択方法が明確でなかった  
**新**: カーソルで「時間設定変更」「やりなおし」「戻る」を選び、ボタン2で決定

### 時間設定画面（02）
**旧**: 左右ボタンで直接操作  
**新**: カーソルで「一時停止 ON/OFF」「時間スケール変更」「決定」を選び、ボタン2で決定または実行

### 各モード画面（06〜08）
**旧**: 直接操作  
**新**: カーソルで「実行」「戻る」を選び、ボタン2で決定

### 種の選択画面（01）
**旧**: カーソル選択  
**新**: 同じ（変更なし、すでにカーソル選択方式だった）

### 花言葉選択画面（09）
**旧**: カーソル選択  
**新**: 同じ（変更なし、すでにカーソル選択方式だった）

---

## 実装への影響

### 必要な変更
1. **入力ハンドラ（input_handler.py）**
   - ボタン1/3の役割を「カーソル移動」に変更
   - 各画面でカーソル位置を管理する仕組みを追加

2. **UIレンダラー（ui/renderer.py）**
   - 各画面でカーソル位置を視覚的に表示
   - メニュー項目のレイアウトとカーソル表示の実装

3. **ゲームエンジン（game_engine.py）**
   - 各画面でカーソル位置の状態管理
   - カーソル移動と決定ボタンのイベント処理
   - 旧仕様の直接遷移ロジックを削除

4. **各画面の状態管理**
   - メイン画面: 5つの選択肢（ステータス、水やり、光、環境整備、設定）
   - 設定画面: 3つの選択肢（時間設定変更、やりなおし、戻る）
   - 時間設定画面: 3つの選択肢（一時停止切替、時間スケール変更、決定）
   - モード画面: 各アクション + 戻る

### テストへの影響
- すべての画面遷移テストをカーソル選択方式に更新
- カーソル循環移動のテストを追加
- カーソル位置の視覚表示テストを追加

---

## 更新された仕様書
- ✅ `docs/specifications/00_概要.md` - 操作セクションを更新
- ✅ `docs/specifications/01_UI定義書.md` - 遷移条件と各画面のメニュー構成を更新
- ✅ `docs/checklists/code-review.md` - 操作方式のチェック項目を更新
- ✅ `docs/checklists/test-cases.md` - テストケースを操作方式に合わせて更新

---

## 次のステップ
1. **Phase 1 の再実装**: 新しい操作方式に基づいた実装
2. **カーソルシステムの実装**: 各画面でのカーソル管理とレンダリング
3. **既存コードのリファクタリング**: 旧仕様の直接遷移ロジックの削除
4. **テストの実施**: 新しい操作方式でのテストケース実行

---

## 備考
この変更により、ゲームの操作性が大幅に向上し、より多くの機能を同じ3ボタンで直感的に操作できるようになります。

