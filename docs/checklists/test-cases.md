## テスト計画（ふらわっち）

本ドキュメントは `docs/` 配下の仕様に基づく受け入れテストケースを整理する。

### 前提/共通事項
- **論理解像度**: 128×128 に全要素が収まること
- **入力デバイス**: ボタン1=カーソル移動（上/左）、ボタン2=決定、ボタン3=カーソル移動（下/右）（PC: 1/2/3キー）
- **操作方式**: すべての画面でカーソル選択→決定の流れを統一
- **初期状態**: データなし時はタイトルから開始。時間は未設定。

---

## 1. 画面フロー/ナビゲーション

### 1-1 タイトル→種の選択
- 前提: タイトル画面を表示
- 操作: 「決定（中央/2）」
- 期待: `種の選択` に遷移

### 1-2 種の選択→時間設定
- 前提: 種の選択を表示
- 操作: 任意の種を選び「決定」
- 期待: `時間設定画面` に遷移

### 1-3 時間設定→メイン
- 前提: 時間設定画面を表示
- 操作: 現在時刻を設定し「決定」
- 期待: `メイン画面` に遷移

### 1-4 メイン画面でのカーソル移動
- 前提: メイン画面
- 操作: ボタン1/3でカーソル移動
- 期待: 選択肢（ステータス、水やり、光、環境整備、設定）間をカーソルが循環移動する
- 期待: 現在のカーソル位置が視覚的に明示される

### 1-5 メイン→設定/ステータス/各モード遷移
- 前提: メイン画面
- 操作: カーソルで「設定」を選択→ボタン2
- 期待: `設定画面`へ遷移
- 操作: カーソルで「ステータス」を選択→ボタン2
- 期待: `ステータス画面`へ遷移
- 操作: カーソルで各モード（水やり/光/環境整備）を選択→ボタン2
- 期待: 該当モード画面へ遷移

### 1-6 設定→時間設定/やりなおし
- 前提: 設定画面
- 操作: カーソルで「時間設定」を選択→ボタン2
- 期待: `時間設定画面` へ
- 操作: カーソルで「やりなおし」を選択→ボタン2
- 期待: セーブデータ初期化後に`タイトル画面`へ
- 操作: カーソルで「戻る」を選択→ボタン2
- 期待: `メイン画面`へ

### 1-7 各モード→メイン復帰
- 前提: 各モード画面（06〜08）
- 操作: カーソルで「戻る」を選択→ボタン2
- 期待: 実行後は `メイン画面` に戻る

### 1-8 自動イベント遷移（花言葉/死亡）
- 前提: メイン画面で時間経過
- 入力: 成長タイマー到達
- 期待: `花言葉選択` へ自動遷移、カーソルで選択肢を選びボタン2で回答→メイン復帰
- 入力: 栄養=0 または寿命到達
- 期待: `死亡/ニューゲーム` へ自動遷移、ボタン2で`タイトル`へ

---

## 2. UI/解像度・レイアウト

### 2-1 解像度制約
- 前提: 全画面/全UI
- 検証: UI要素・キャラ・テキストの描画座標が 0..127 の範囲内
- 期待: 逸脱なし（512×512 物理拡大は論理解像度に影響しない）

### 2-2 ボタン割当
- 前提: PC 実行
- 検証: 1=カーソル移動（上/左）, 2=決定, 3=カーソル移動（下/右）の入力で対応機能が発火
- 期待: 仕様通りの遷移/操作が行える
- 期待: カーソル移動は循環する（最後の項目→最初の項目）

---

## 3. 状態パラメータ

対象: 栄養/環境(雑草除去)/光/言葉(メンタル)/年齢

### 3-1 初期値と範囲
- 検証: 初期値（栄養0, 環境0, 光50, 言葉0, 年齢0）で開始
- 期待: それぞれの範囲にクランプ（0〜100 もしくは加算のみ）

### 3-2 栄養の増減
- 操作: 水やり/肥料行為
- 期待: 栄養が増加し、一定以上で成長速度に正影響
- 期待: 栄養<20 のとき表情がしょんぼり表示

### 3-3 環境（雑草除去）
- 操作: 環境整備ミニゲームで雑草/害虫を除去
- 期待: 環境が上昇し、値が低いと進行阻害の演出/進捗低下

### 3-4 光（ON/OFF/蓄積）
- 操作: 光モード ON/OFF により蓄積を変動
- 期待: 閾値 50 を境に陰/陽傾向が更新される

### 3-5 言葉（メンタル）
- 操作: すき/きらいの入力によりメンタル変動
- 期待: 高いほど王道寄りの分岐に寄与

### 3-6 年齢
- 操作: 時間経過/早送り
- 期待: 成長フェーズのトリガーに利用される

---

## 4. 制約・例外ルール

### 4-1 1時間内の連続栄養行為
- 前提: 同一 1 時間内
- 操作: 水やり/餌やりを 3 回以上実行
- 期待: 3 回目以降の効果は無効（数値/演出で確認）

### 4-2 睡眠中の操作不可
- 前提: 睡眠時間帯
- 操作: 光モード/ミニゲーム実行
- 期待: 入力無効 or 実行不可のメッセージ

### 4-3 自動遷移限定画面
- 期待: 花言葉選択/死亡画面は自動遷移でのみ表示
- 検証: 手動遷移経路が存在しない

### 4-4 リセット
- 操作: 設定画面の「やりなおし」
- 期待: セーブデータ削除・初期化後、タイトルへ

---

## 5. 成長フェーズ分岐

共通ロジック: パラメータ/属性に重み付けし、最大スコア候補を採択。同点は乱択。

### 5-1 フェーズ1（種→芽）
- シナリオA: 光=50 以上（陽寄り）→ ハート芽になりやすい
- シナリオB: 光=49 以下（陰寄り）→ 棘芽になりやすい
- 検証: 境界値（49/50）で分岐が切り替わること

### 5-2 フェーズ2（芽→茎）
- シナリオA: 総合70〜100 → まっすぐ
- シナリオB: 総合40〜69 → しなる
- シナリオC: 総合0〜39 → つる
- シナリオD: その他 → ふつう
- 検証: 精神良好(70+)が王道寄りにバイアスすること

### 5-3 フェーズ3（茎→蕾）
- 入力: 種×芽×茎、光傾向
- 期待: 形（まるまる/大輪/ひらひら/ちいさめ/とがり/ふつう）の決定
- 検証: 種×茎相性と光傾向で選好が変化

### 5-4 フェーズ4（蕾→花）
- 入力: 年齢到達 + 栄養/光/精神
- 期待: 最終進化（例: たんぽぽ/さくら/ひまわり 等）へ
- 検証: 成長完了時に花言葉選択へ自動遷移し、回答後メインへ

---

## 6. ステータス表示

### 6-1 ステータス画面の内容
- 前提: メインから右ボタンで遷移
- 期待: 栄養/環境/光/メンタル/年齢が想定レンジで表示

---

## 7. キャラクター（種）選択

### 7-1 種の選択と属性反映
- 操作: `03_キャラクター.md` の一覧から任意の種を選択
- 期待: 遺伝因子・性格・タイプが分岐重みに反映（実装注の加点方式）

---

## 8. 早送り/一時停止（時間設定画面）

### 8-1 早送り
- 操作: 早送りを有効化
- 期待: 年齢やパラメータ変化が高速に進むが制約は維持

### 8-2 一時停止
- 操作: 一時停止
- 期待: 時間依存イベント（成長/自動遷移）が停止

---

## 9. 乱択の再現性（任意）
- 前提: 同点時のランダム採択
- 操作: 乱数シード固定で同結果、シード変更で結果が変わる
- 期待: 乱択が仕様に従う

---

## 付録：境界値一覧（抜粋）
- 光: 49/50（陰/陽の閾値）
- 精神: 69/70（王道寄りバイアス閾値）
- 栄養: 19/20（表情変化）
- 連続栄養行為: 2/3 回（同一時間内の効果打ち止め）

