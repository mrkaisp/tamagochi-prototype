# ふらわっち 実装改善作業計画書

**作成日**: 2026年1月12日  
**最終更新**: 2026年1月12日（v2 - 仕様ドキュメント分析追加）  
**対象バージョン**: Phase 1 完了後（カーソル選択方式実装済み）

---

## 1. 現状分析サマリー

### 1.1 実装完了項目 ✅

| カテゴリ | 項目 | 状態 |
|---------|------|------|
| UI/操作 | カーソル選択方式 | ✅ 完了 |
| UI/操作 | 画面遷移システム（11画面） | ✅ 完了 |
| UI/操作 | メニューシステム | ✅ 完了 |
| 育成 | 基本パラメータ管理（水・光・環境・メンタル） | ✅ 完了 |
| 育成 | 成長段階システム（種→芽→茎→蕾→花） | ✅ 完了 |
| 育成 | 成長分岐ロジック（フェーズ1〜4） | ✅ 基本実装 |
| データ | セーブ/ロード機能 | ✅ 完了 |
| データ | 自動セーブ | ✅ 完了 |
| テスト | 基本ユニットテスト | ✅ 一部完了 |

### 1.2 検出されたコードの問題点

#### 🔴 優先度: 高（バグ・不整合）

| No | 問題 | 影響度 | ファイル |
|----|------|--------|----------|
| H-1 | `_setup_event_handlers` メソッドが2箇所で重複定義 | 高 | `game_engine.py` (L177, L524) |
| H-2 | テストの期待値が実装と不一致（water_level/light_level初期値） | 中 | `test_pet_state.py` (L25-26) |
| H-3 | READMEの操作方法説明が古い仕様と混在 | 中 | `README.md` (L233-249) |

#### 🟡 優先度: 中（機能未実装・仕様未達成）

| No | 問題 | 関連仕様 | ファイル |
|----|------|----------|----------|
| M-1 | 光OFF機能が未実装（TODOコメントのみ） | `01_UI定義書.md` | `game_engine.py` (L732-735) |
| M-2 | 種選択が4種類（太陽/月/風/雨）のみ、仕様のキャラクター10種未対応 | `03_キャラクター.md` | `flower.py`, `game_engine.py` |
| M-3 | 成長分岐のデータ駆動化未実装（JSONテーブル化） | `Phase2_and_beyond_plan.md` | `flower.py` |
| M-4 | パラメータ演出未実装（栄養<20の表情変化等） | `02_状態パラメータ.md` | `renderer.py` |
| M-5 | 花言葉イベント拡張未実装（エンディングテキスト） | `Phase2_and_beyond_plan.md` | `game_engine.py` |

#### 🟢 優先度: 低（改善・整理）

| No | 問題 | 説明 | ファイル |
|----|------|------|----------|
| L-1 | バックアップファイルが残存 | `.bak` ファイルの整理 | `src/game/core/`, `src/game/ui/` |
| L-2 | ログ出力が簡易的 | 成長分岐のスコア詳細等が出力されない | `flower.py`, `game_engine.py` |
| L-3 | 乱数シード設定APIが限定的 | CLI/テストからの設定が困難 | `random_manager.py` |

---

## 2. 仕様ドキュメントの問題点分析 🆕

### 2.1 ドキュメント間の不整合

#### 🔴 D-1: パラメータ初期値の不整合

| ドキュメント | 栄養(water) | 光(light) | 環境 | メンタル |
|--------------|-------------|-----------|------|----------|
| `02_状態パラメータ.md` | 50 | 50 | 0 | 0 |
| `code-review.md` | 0 | 50 | 0 | 0 |
| `04_フェーズ1.md` | - | 0から開始 | - | - |
| **実装（flower.py）** | **50** | **0** | **0** | **0** |

**必要なアクション**: 
- `02_状態パラメータ.md` を実装に合わせて更新（light初期値: 50→0）
- `code-review.md` を実装に合わせて更新（water初期値: 0→50）

---

#### 🔴 D-2: 表情変化の閾値不整合

| ドキュメント | 閾値 |
|--------------|------|
| `02_状態パラメータ.md` | 栄養<20でしょんぼり |
| `06_擬人化キャラデザイン.md` | 栄養<30で弱い表情 |
| `code-review.md` | 栄養<20でしょんぼり |

**必要なアクション**: 
- `06_擬人化キャラデザイン.md` の閾値を20に統一、または段階を明確化
  - 提案: 20未満=しょんぼり、20-59=普通、60以上=元気

---

#### 🔴 D-3: 雑草/害虫が0の時の挙動矛盾

| ドキュメント | 記載内容 |
|--------------|----------|
| `01_UI定義書.md` | 「雑草数/害虫数が0でも環境レベルは上昇する（実装上の仕様）」 |
| `code-review.md` | 「雑草数が0の時は環境レベルが上昇しない（または適切なメッセージ表示）」 |

**必要なアクション**: 
- 仕様を確定し、ドキュメントを統一
- 提案: 雑草/害虫が0の場合は「雑草はありません」メッセージを表示し、環境レベルは上昇しない

---

#### 🟡 D-4: 陰/陽傾向の更新タイミング矛盾

| ドキュメント | 記載内容 |
|--------------|----------|
| `02_状態パラメータ.md` | 「成長段階に関係なく常時更新されるわけではない」 |
| `code-review.md` | 「光ON処理：光レベルが閾値50を超えた/下回った時に即座に更新される」 |
| **実装（flower.py）** | **成長時（種→芽）にのみ決定される** |

**必要なアクション**: 
- `code-review.md` を実装に合わせて修正
- 成長時決定方式であることを明確化

---

### 2.2 仕様の定義不足

#### 🔴 D-5: 光OFF機能の仕様不足

**現状**: `01_UI定義書.md` に「光 OFF（実装予定、現在はメッセージ表示のみ）」と記載のみ

**不足している仕様**:
- 光OFF時の効果（減少量は？ -10.0? -15.0?）
- 使用条件（睡眠中は使用不可？）
- 光レベルが0以下になった場合の挙動

**必要なアクション**: 
- `01_UI定義書.md` または新規ファイルで光OFF仕様を定義
- 提案仕様:
  ```
  光OFF: 光蓄積を-10.0（light_amountと同量）
  使用条件: 睡眠中は操作不可
  下限: 0（マイナスにはならない）
  ```

---

#### 🔴 D-6: 死亡条件の仕様不足

**現状の記載**:
- `01_UI定義書.md`: 「栄養0 or 寿命到達」で死亡
- 実装（flower.py L399）: `water_level > 5.0` （5以下で死亡）

**不足している仕様**:
- 死亡閾値（0なのか5なのか）
- 寿命の具体的な数値（何秒？何時間？）
- 死亡時の演出・メッセージ

**必要なアクション**: 
- 死亡条件を明確に定義
- 提案: 「栄養≦5で枯死」「寿命: 未実装（将来的に実装）」

---

#### 🟡 D-7: エンディング/花言葉結果の仕様不足

**現状**: フェーズ4完了後に花言葉選択画面へ遷移するが、その後の仕様がない

**不足している仕様**:
- 花言葉選択（好き/嫌い）の影響
- エンディングテキストのバリエーション
- 結果の保存形式
- 周回プレイの仕組み

**必要なアクション**: 
- `specifications/07_エンディング.md` を新規作成
- 花言葉選択の結果がどのように表示されるかを定義

---

#### 🟡 D-8: キャラクター10種の分岐影響詳細

**現状**: `03_キャラクター.md` に10種のキャラクターが列挙されているが、分岐計算への影響が不明確

**不足している仕様**:
- 各キャラクターの遺伝因子が分岐スコアにどう加点されるか
- 性格（わんぱく/やさしい/クール等）の影響
- 複合遺伝因子（月×風 等）の計算方法

**必要なアクション**: 
- `03_キャラクター.md` に分岐影響テーブルを追加
- または `05_成長分岐表.md` にキャラクター別加点を追記

---

#### 🟡 D-9: 環境整備ミニゲームの仕様不足

**現状**: `01_UI定義書.md` で「環境整備ミニゲーム」と記載されているが、現在は単純なメニュー選択

**不足している仕様**:
- ミニゲームのルール
- 成功/失敗の判定基準
- 成功時/失敗時の効果量

**必要なアクション**: 
- `specifications/08_ミニゲーム.md` を新規作成
- または Phase 4 実装時に仕様を確定

---

### 2.3 ドキュメント更新マトリックス

| ドキュメント | 更新内容 | 関連問題 | 優先度 |
|--------------|----------|----------|--------|
| `02_状態パラメータ.md` | 初期値を実装と統一（light: 50→0） | D-1 | 高 |
| `code-review.md` | 初期値を実装と統一（water: 0→50）、陰陽更新タイミング修正 | D-1, D-4 | 高 |
| `06_擬人化キャラデザイン.md` | 表情閾値を統一（30→20） | D-2 | 中 |
| `01_UI定義書.md` | 光OFF仕様追記、死亡条件追記、雑草0時挙動確定 | D-3, D-5, D-6 | 高 |
| `03_キャラクター.md` | 分岐影響テーブル追加 | D-8 | 中 |
| `05_成長分岐表.md` | キャラクター別加点情報追加 | D-8 | 中 |
| `specifications/07_エンディング.md` | **新規作成** | D-7 | 中 |
| `specifications/08_ミニゲーム.md` | **新規作成**（Phase 4時） | D-9 | 低 |
| `README.md` | 操作方法をカーソル仕様に統一 | H-3 | 高 |

---

## 3. 作業フェーズ計画（更新版）

### Phase 2A: バグ修正・ドキュメント整合性（優先度: 最高）

**目標**: コード品質の安定化 + 仕様ドキュメントの整合性確保

| タスクID | タスク名 | 詳細 | 工数目安 |
|----------|----------|------|----------|
| 2A-1 | 重複メソッド修正 | `game_engine.py` の `_setup_event_handlers` 重複を解消 | 0.5h |
| 2A-2 | テスト修正 | `test_pet_state.py` の期待値を実装に合わせて修正 | 0.5h |
| 2A-3 | README更新 | 古いキー操作説明を削除、カーソル操作仕様に統一 | 1h |
| 2A-4 | バックアップ整理 | `.bak` ファイルを削除 | 0.5h |
| **2A-5** | **仕様書初期値統一** | `02_状態パラメータ.md`、`code-review.md` の初期値を実装と統一 | 0.5h |
| **2A-6** | **表情閾値統一** | `06_擬人化キャラデザイン.md` の閾値を20に統一 | 0.5h |
| **2A-7** | **挙動矛盾解消** | `01_UI定義書.md` の雑草0時挙動、`code-review.md` の陰陽更新タイミングを修正 | 0.5h |

**完了条件**:
- [ ] `python -m pytest -q` が全件グリーン
- [ ] lintエラーなし
- [ ] 仕様書間の初期値・閾値が統一されている
- [ ] READMEの操作説明が仕様書と一致

---

### Phase 2B: 受け入れテスト対応 + 機能補完（優先度: 最高）

**目標**: 受け入れテスト指摘事項の修正 + 仕様書に記載の基本機能を完成させる

#### 2B-1: 受け入れテスト対応（優先度: 最高）

| タスクID | タスク名 | 詳細 | 工数目安 |
|----------|----------|------|----------|
| **2B-1.1** | **UI改善: タイトル画面文字中央配置** | `renderer.py` でタイトル画面の文字を画面中央に配置、文字サイズを統一 | 1h |
| **2B-1.2** | **UI改善: 種キャラサイズ拡大** | 種段階のキャラクターサイズを拡大し、表情が分かるようにする | 1h |
| **2B-1.3** | **UI改善: 時計表示追加** | メイン画面にゲーム内時間（時計）を表示する | 1.5h |
| **2B-1.4** | **機能削除: 睡眠機能削除** | `_is_sleep_time()` チェックを全て削除、睡眠関連設定を削除 | 2h |
| **2B-1.5** | **機能削除: 環境整備機能削除** | 環境整備モード画面、雑草/害虫除去機能を完全削除 | 2h |
| **2B-1.6** | **ドキュメント: READMEにテスト用オプション実行コマンド追加** | テスト用オプションの実行方法をREADMEに追記 | 0.5h |
| **2B-1.7** | **解像度変更: 240×240に統一** | 物理表示も240×240に変更（base_scale=1）、renderer.pyの定数を240に修正 | 1h |

#### 2B-2: 機能補完 + 仕様定義（優先度: 高）

| タスクID | タスク名 | 詳細 | 工数目安 |
|----------|----------|------|----------|
| **2B-2.1** | **光OFF仕様定義** | `01_UI定義書.md` に光OFF仕様を追記（効果量、下限） | 0.5h |
| 2B-2.2 | 光OFF機能実装 | 仕様に基づき `_perform_light_off` を実装 | 1h |
| **2B-2.3** | **死亡条件仕様定義** | `01_UI定義書.md` に死亡閾値（≦5）、寿命未実装を明記 | 0.5h |
| 2B-2.4 | 成長分岐データ化 | `src/game/data/growth_tables.json` を追加、ハードコード外部化 | 3h |
| 2B-2.5 | パラメータ演出 | `renderer.py` で栄養<20時の表情変化を実装 | 2h |
| **2B-2.6** | **エンディング仕様定義** | `specifications/07_エンディング.md` を新規作成 | 1h |
| 2B-2.7 | 花言葉拡張 | 仕様に基づきエンディングテキスト表示を実装 | 2h |

**完了条件**:
- [ ] タイトル画面の文字が中央配置され、文字サイズが統一されている
- [ ] 種段階のキャラクターが大きく表示され、表情が分かる
- [ ] メイン画面に時計が表示される
- [ ] 睡眠機能が完全に削除されている（コード・設定・ドキュメント）
- [ ] 環境整備機能が完全に削除されている（コード・設定・ドキュメント）
- [ ] READMEにテスト用オプションの実行コマンドが記載されている
- [ ] 画面解像度が240×240に統一されている（物理表示も240×240）
- [ ] 光ON/OFFが両方動作し、仕様書に動作が記載されている
- [ ] 成長分岐パラメータがJSONから読み込まれる
- [ ] 栄養低下時に視覚的なフィードバックがある
- [ ] エンディング仕様書が存在する

---

### Phase 3: テスト・ログ・再現性強化

**目標**: 品質保証とデバッグ効率を向上させる

| タスクID | タスク名 | 詳細 | 工数目安 |
|----------|----------|------|----------|
| 3-1 | 画面遷移テスト | `tests/test_screen_transitions.py` を新規作成 | 3h |
| 3-2 | 制約ルールテスト | 栄養行為制限のテストを追加（睡眠機能削除により睡眠テストは不要） | 1.5h |
| 3-3 | 成長分岐テスト | フェーズ1〜4の境界値テスト | 2h |
| 3-4 | 乱数シードAPI拡張 | CLI引数 `--seed` でシード指定可能に | 1h |
| 3-5 | ログ詳細化 | 成長分岐のスコア計算過程をログ出力 | 2h |
| 3-6 | セーブ堅牢性 | バージョンメタデータ追加、復旧フロー実装 | 2h |
| **3-7** | **仕様書-テスト紐付け** | テストケースに対応する仕様書セクションをコメントで明記 | 1h |

**完了条件**:
- [ ] テストカバレッジが主要シナリオを網羅
- [ ] 同一シードで同一結果が再現される
- [ ] ログから成長分岐の判定理由が追跡可能
- [ ] 各テストが仕様書と紐付いている

---

### Phase 4: 体験向上・運用整備

**目標**: ゲームとしての完成度を高める

| タスクID | タスク名 | 詳細 | 工数目安 |
|----------|----------|------|----------|
| **4-1** | **キャラクター分岐仕様** | `03_キャラクター.md` に分岐影響テーブルを追加 | 1h |
| 4-2 | キャラクター拡張 | 10種類のキャラクターを実装 | 4h |
| 4-3 | アセット刷新 | 成長段階/分岐結果に応じたスプライト差分を追加 | 8h |
| 4-4 | パフォーマンス最適化 | 早送り時のフレームタイム計測、描画更新抑制 | 2h |
| 4-5 | ドキュメント最終整備 | README/仕様書を最新実装に完全同期 | 2h |

**完了条件**:
- [ ] 全10種のキャラクターが選択可能で、分岐影響が明確
- [ ] Raspberry Pi環境で安定動作

---

## 4. 優先タスクリスト（推奨実行順）

### 🔴 即座に対応すべき項目（Phase 2A）

```
1. [2A-1] 重複メソッド修正（バグ）
2. [2A-5] 仕様書初期値統一（ドキュメント整合性）
3. [2A-2] テスト修正（CI/CD対応）
4. [2A-6] 表情閾値統一（ドキュメント整合性）
5. [2A-7] 挙動矛盾解消（ドキュメント整合性）
6. [2A-3] README更新（ドキュメント整合性）
7. [2A-4] バックアップ整理
```

### 🟡 次に対応すべき項目（Phase 2B - 受け入れテスト対応優先）

```
【受け入れテスト対応（最優先）】
1. [2B-1.1] UI改善: タイトル画面文字中央配置
2. [2B-1.2] UI改善: 種キャラサイズ拡大
3. [2B-1.3] UI改善: 時計表示追加
4. [2B-1.4] 機能削除: 睡眠機能削除
5. [2B-1.5] 機能削除: 環境整備機能削除
6. [2B-1.6] ドキュメント: READMEにテスト用オプション実行コマンド追加
7. [2B-1.7] 解像度変更: 240×240に統一

【機能補完】
7. [2B-2.1] 光OFF仕様定義 → [2B-2.2] 光OFF機能実装
8. [2B-2.3] 死亡条件仕様定義
9. [2B-2.4] 成長分岐データ化
10. [2B-2.5] パラメータ演出
11. [2B-2.6] エンディング仕様定義 → [2B-2.7] 花言葉拡張
```

### 🟢 その後（Phase 3-4）

```
12. [3-1] 画面遷移テスト
13. [3-3] 成長分岐テスト
14. [3-7] 仕様書-テスト紐付け
15. [4-1] キャラクター分岐仕様 → [4-2] キャラクター拡張
```

---

## 5. ファイル別変更予定（更新版）

### コードファイル

| ファイル | 変更内容 | 関連タスク |
|----------|----------|------------|
| `src/game/core/game_engine.py` | 重複メソッド削除、光OFF実装、睡眠機能削除、環境整備機能削除 | 2A-1, 2B-1.4, 2B-1.5, 2B-2.2 |
| `src/game/entities/flower.py` | 成長分岐データ読み込み、ログ出力追加、環境整備機能削除 | 2B-2.4, 2B-1.5, 3-5 |
| `src/game/ui/renderer.py` | パラメータ演出追加、タイトル画面文字中央配置、種キャラサイズ拡大、時計表示、解像度定数修正 | 2B-1.1, 2B-1.2, 2B-1.3, 2B-1.7, 2B-2.5 |
| `src/game/data/config.py` | シード設定拡張、睡眠設定削除、base_scale=1に変更 | 2B-1.4, 2B-1.7, 3-4 |
| `src/game/core/screen_state.py` | MODE_ENV削除 | 2B-1.5 |
| `src/game/data/growth_tables.json` | 新規作成（成長分岐テーブル） | 2B-2.4 |
| `tests/test_pet_state.py` | 期待値修正 | 2A-2 |
| `tests/test_screen_transitions.py` | 新規作成 | 3-1 |
| `tests/test_growth_branching.py` | 新規作成 | 3-3 |

### ドキュメントファイル

| ファイル | 変更内容 | 関連タスク |
|----------|----------|------------|
| `README.md` | 操作説明更新 | 2A-3 |
| `docs/specifications/02_状態パラメータ.md` | 初期値修正（light: 50→0） | 2A-5 |
| `docs/specifications/06_擬人化キャラデザイン.md` | 表情閾値を20に統一 | 2A-6 |
| `README.md` | 操作説明更新、テスト用オプション実行コマンド追加 | 2A-3, 2B-1.6 |
| `docs/specifications/01_UI定義書.md` | 光OFF仕様追記、死亡条件追記、雑草0時挙動修正、睡眠機能削除、環境整備機能削除 | 2A-7, 2B-1.4, 2B-1.5, 2B-2.1, 2B-2.3 |
| `docs/checklists/code-review.md` | 初期値修正、陰陽更新タイミング修正、睡眠機能削除、環境整備機能削除 | 2A-5, 2A-7, 2B-1.4, 2B-1.5 |
| `docs/specifications/03_キャラクター.md` | 分岐影響テーブル追加 | 4-1 |
| `docs/specifications/07_エンディング.md` | **新規作成** | 2B-2.6 |

---

## 6. リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| 睡眠機能・環境整備機能削除で既存コードに影響 | 高 | 削除前に影響範囲を確認し、段階的に削除。テストで回帰確認 |
| 成長分岐のデータ化で既存ロジックが壊れる | 高 | 変更前にテストを追加し、リグレッションを検知 |
| UI演出追加でパフォーマンス低下 | 中 | 早送り時の描画更新頻度を制限 |
| キャラクター拡張でセーブ互換性が崩れる | 中 | バージョンフィールドを追加し、マイグレーション処理を実装 |
| 仕様変更でテストが全て修正必要 | 中 | 仕様確定後にテストを書く順序を徹底 |

---

## 7. 付録

### A. 重複メソッド定義（game_engine.py）

```python
# L177-204: 最初の定義（不完全）
def _setup_event_handlers(self) -> None:
    """イベントハンドラーを設定"""
    self.event_manager.subscribe(EventType.FLOWER_WATERED, ...)
    # ナビゲーション/時間制御のサブスクライブがない

# L524-561: 2番目の定義（完全）
def _setup_event_handlers(self) -> None:
    """イベントハンドラーを設定"""
    # 全てのサブスクライブを含む
```

**修正方針**: L524-561の内容をL177-204に統合し、L524以降の定義を削除

### B. テスト期待値の不一致（test_pet_state.py）

```python
# L25-26: コメントと実装が逆
self.assertEqual(self.stats.water_level, 0.0)  # 実装は50.0
self.assertEqual(self.stats.light_level, 50.0)  # 実装は0.0
```

**修正方針**: `flower.py` の `FlowerStats` クラスの初期値に合わせる

### D. 受け入れテスト対応タスク詳細

#### D-1. UI改善: タイトル画面文字中央配置（2B-1.1）

**問題**: タイトル画面の「ふらわっち」が画面中央に配置されていない。文字サイズが統一されていない。

**修正内容**:
- `renderer.py` の `_render_title()` メソッドを修正
- 240×240画面の中央（x=120, y=120）に配置
- 文字サイズを統一（推奨: 24px）
- 他の画面タイトルも同様に中央配置・サイズ統一を確認

**影響ファイル**: `src/game/ui/renderer.py`

---

#### D-2. UI改善: 種キャラサイズ拡大（2B-1.2）

**問題**: 種段階のキャラクターが小さすぎて表情が分からない。

**修正内容**:
- `renderer.py` の `flower_sprite` のサイズを段階別に調整
- 種段階: 現在80×80 → 100×100以上に拡大
- 成長段階に応じたサイズ調整（種 > 芽 > 茎 > 蕾 > 花）

**影響ファイル**: `src/game/ui/renderer.py`

---

#### D-3. UI改善: 時計表示追加（2B-1.3）

**問題**: ゲーム内時間（時計）が表示されていない。

**修正内容**:
- メイン画面の右上または適切な位置に時計を表示
- `format_time_digital()` を使用してデジタル時計形式で表示
- 240×240画面内に収まるように配置

**影響ファイル**: `src/game/ui/renderer.py`

---

#### D-4. 機能削除: 睡眠機能削除（2B-1.4）

**問題**: 睡眠機能が不要。睡眠中に光ONできない仕様を削除したい。

**修正内容**:
- `game_engine.py` の `_is_sleep_time()` メソッドを削除
- 全ての `_is_sleep_time()` チェックを削除（光ON、雑草除去、害虫駆除、メンタル操作）
- `config.py` の `sleep_start_hour`, `sleep_end_hour` を削除
- ドキュメントから睡眠関連の記載を削除

**影響ファイル**:
- `src/game/core/game_engine.py`
- `src/game/data/config.py`
- `docs/specifications/01_UI定義書.md`
- `docs/checklists/code-review.md`

---

#### D-5. 機能削除: 環境整備機能削除（2B-1.5）

**問題**: 環境整備機能を丸ごと削除する。

**修正内容**:
- `ScreenState.MODE_ENV` を削除
- メイン画面の「環境整備」メニュー項目を削除
- `_perform_remove_weeds()`, `_perform_remove_pests()` メソッドを削除
- `flower.py` の `remove_weeds()`, `remove_pests()` メソッドを削除
- `FlowerStats` の `weed_count`, `pest_count`, `environment_level` を削除（または使用停止）
- 環境整備関連のイベントハンドラーを削除
- ドキュメントから環境整備関連の記載を削除

**影響ファイル**:
- `src/game/core/game_engine.py`
- `src/game/core/screen_state.py`
- `src/game/entities/flower.py`
- `src/game/ui/renderer.py`
- `docs/specifications/01_UI定義書.md`
- `docs/checklists/code-review.md`

**注意**: 環境レベルは成長分岐に影響する可能性があるため、削除前に影響範囲を確認すること。

---

#### D-6. ドキュメント: READMEにテスト用オプション実行コマンド追加（2B-1.6）

**問題**: テスト用オプションでの実行コマンドがREADMEに記載されていない。

**修正内容**:
- READMEにテスト用オプションの実行方法を追記
- `config.py` の `nutrition_limit_disabled` を `True` に設定する方法
- または、コマンドライン引数で指定する方法（実装する場合）

**影響ファイル**: `README.md`

---

#### D-7. 解像度変更: 240×240に統一（2B-1.7）

**問題**: 最終的にハード画面で240×240にするため、物理表示も240×240に統一する必要がある。

**修正内容**:
- `config.py` の `base_scale` を 4 → 1 に変更（物理表示も240×240にする）
- `renderer.py` の `DISPLAY_WIDTH` と `DISPLAY_HEIGHT` を 236 → 240 に変更
- ドキュメントの「4倍スケール（960×960ピクセル）」という記載を削除し、240×240固定であることを明記

**影響ファイル**:
- `src/game/data/config.py`
- `src/game/ui/renderer.py`
- `README.md`
- `docs/specifications/00_概要.md`

### C. 仕様定義テンプレート（07_エンディング.md）

```markdown
## エンディング仕様

### 花言葉選択の影響
- 「好き」を伝える: メンタル+5
- 「嫌い」を伝える: メンタル-5

### エンディングテキスト
| 条件 | テキスト |
|------|----------|
| メンタル70以上 + 大輪 | 「あなたの愛情で、立派な花が咲きました」 |
| メンタル30未満 | 「花は静かに、あなたを見つめています」 |
| デフォルト | 「花が咲きました。ありがとう」 |

### 結果の保存
- セーブデータに最終エンディング情報を記録
- 周回数をカウント
```

---

## 更新履歴

| 日付 | 更新者 | 内容 |
|------|--------|------|
| 2026-01-12 | - | 初版作成 |
| 2026-01-12 | - | v2: 仕様ドキュメント分析追加、ドキュメント更新タスク追加 |
| 2026-01-12 | - | v3: 受け入れテスト対応タスク追加（UI改善、睡眠機能削除、環境整備機能削除、時計表示、テスト用オプション実行コマンド） |
| 2026-01-12 | - | v4: 解像度変更タスク追加（240×240に統一、物理表示も240×240） |